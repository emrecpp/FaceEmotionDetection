{% extends 'main.html' %}
{% block content %}
    <script>
        function resimYuklenemedi() {
            //document.querySelector('.img').src = "{{ url_for('static', filename='images/placeholder.png') }}";
            const img = document.querySelector(".img")
            img.src = 'static/images/loading.gif';
            img.style.width = "128"
            img.style.height = "128"
            img.style.borderRadius = "50%"
        }

        function statlariOku() {
            fetch("/stats")
                .then(response => response.json())
                .then(data => {
                    if (data === null)
                        return

                    let enYuksekSkorluDuygu = Object.keys(data).reduce((a, b) => data[a].percentage > data[b].percentage ? a : b);
                    for (const [key, value] of Object.entries(data)) {
                        const targetStat = document.getElementById(`statlar-${key}`)
                        targetStat.querySelector("span").innerHTML = `${value.title}: <b>%${value.percentage}</b>`

                            targetStat.style.background = key === enYuksekSkorluDuygu ? "#5adbb2" : "#fff"
                    }


                }).catch(err => {
                console.error("Stat okunurken hata: ", err)
                clearInterval(statIntervalId)
            })
        }

        var statIntervalId = setInterval(statlariOku, 200);
    </script>
    <div class="flex flex-col gap-10 max-w-7xl justify-evenly m-auto h-full">
        <style>

            .img {
                width: 1000px;
                height: 600px;
                /*width:100%;
                height:100%;*/
                border-radius: 20px;
                margin: auto;
            }

            .stat-card {
                background: #fff;
                padding: 10px;
                border-radius: 10px;
                box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                width: max-content;
                min-width: 150px;
            }

            #wrapper-statlar {
                box-shadow: rgba(17, 12, 46, 0.15) 0px 48px 100px 0px;
                width: min-content;
                margin: auto;
            }
        </style>
        <h1 class="text-center font-bold text-5xl text-slate-600">Duygunu Söyle ve Göster</h1>
        <img style="box-shadow: 0 0 10px black;" class="img mt-10" src="{{ url_for('kameradan_goruntu_al') }}"
             alt="Kullanıcı Resmi"
             onerror="resimYuklenemedi()">
        <div id="wrapper-statlar"
             class="flex justify-center items-center gap-8 border-2 border-zinc-200 p-8 rounded-xl w-full">
            <div id="statlar-happy" class="stat-card">
                <img src="static/images/happy.png" alt="happy" style="width: 48px; height: 48px">
                <span>Mutlu: %0</span>
            </div>
            <div id="statlar-neutral" class="stat-card">
                <img src="static/images/neutral.png" alt="neutral" style="width: 48px; height: 48px">
                <span>Normal: %0</span>
            </div>
            <div id="statlar-sad" class="stat-card">
                <img src="static/images/sad.png" alt="sad" style="width: 48px; height: 48px">
                <span>Üzgün: %0</span>
            </div>
            <div id="statlar-angry" class="stat-card">
                <img src="static/images/angry.png" alt="angry" style="width: 48px; height: 48px">
                <span>Kızgın: %0</span>
            </div>
            <div id="statlar-disgust" class="stat-card">
                <img src="static/images/disgust.png" alt="disgust" style="width: 48px; height: 48px">
                <span>İğrenmiş: %0</span>
            </div>
        </div>
    </div>
    <br>

{% endblock %}